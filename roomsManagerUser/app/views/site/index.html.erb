<div class="top4"></div>
<div class="container-fluid offset1">
	<!-- / HEADER -->
	<div class="row-fluid">
		<div class="span9">
			<div class="well">
				<div id="calendario_reservas" class="datepicker" class="offset2"></div>
			</div>
		</div>
		<div class="span2">
			<h4> LABORATÓRIO </h4>
			<ul class="nav nav-tabs nav-stacked" style="background: #fff;">
				<%
				for sala in @salas
					if(sala[1] == "Laboratorio")
				%>
				<li>
					<% 
					labReservado = false
					for reserva in @reservas
						if(reserva["sala"]["nome"] == sala[0])
							#puts YAML::dump(reserva["horarioTermino"])
							#se horario de termino igual a 00:00 chave ainda nao entregue
							if(reserva["horarioTermino"] != "00:00:00")
								labReservado = true
							end
						end
					end

					if(labReservado)
					%>
					<a href="#" title="Lab. Liberado">
						<i class="icon-green icon-ok"></i>
						<%=sala[0]%>
					</a>
					<%else%>
					<a href="#" title="Lab. Ocupado">
						<i class="icon-red icon-remove"></i>
						<%=sala[0]%>
					</a>
					<%end%>
				</li>
				<%
					end

				end
				%>
			</ul>
		</div>
	</div>
	<div class="row-fluid"> 
		<div class="span11">
			<div>
				<h1><%=@data%></h1>
			</div>
			<table id="reservas" class="table table-striped table-bordered">
				<tbody>
					<tr>
						<td class="span4">Inicio<br/>Fim</td>
						<%	
						horarioInicial = Array.new(1){""}
						
						(7..23).each do|e|
							i = e-7
							if(e < 10)
								horarioInicial[i] = "0"+e.to_s+":00"
							else
								horarioInicial[i] = e.to_s+":00"
							end
						end
						
						horarioFinal = Array.new(1){""}
						
						(8..24).each do|e|
							i = e-8
							if(e < 10)
								horarioFinal[i] = "0"+e.to_s+":00"
							else
								if(e != 24)
									horarioFinal[i] = e.to_s+":00"
								else
									horarioFinal[i] = "00:00"
								end
							end
						end

						for i in 0..horarioInicial.size-1 do
						%>
						<td class="span2"><%=horarioInicial[i]%> <%=horarioFinal[i]%></td>
						<%end%>
					</tr>
					<% 
					i = 0
					reservados = {}
					
					#pegando todas as sala
					for sala in @salas
						#tipo da sala
						if(sala[1] != "Laboratorio")
							#sala[0] => nome da sala
							reservados[sala[0]] = {}
							reservados[sala[0]]['horario'] = Array.new(horarioInicial){false}
						end
					end


					tabela_reserva = Array.new(horarioInicial){false}
					for reserva in @reservas
						
						hi = reserva["horarioInicio"] #horarioInicial
						hi = hi[0..1]

						hf = reserva["horarioTermino"]
						hf = hf[0..1]
						
						intervalo = hf.to_i - hi.to_i
						(0..intervalo-1).each do|j|
							# 7 é a posição inicial de tabela_reserva
							tabela_reserva[hi.to_i-7+j.to_i] = true
						end

						if(reservados.has_key?(reserva["sala"]["nome"]))
							reservados[reserva["sala"]["nome"]]['horario'] = tabela_reserva
						end
					end

					%>
					<% reservados.each do|e,i|%>
					<tr>
						<td class="span4"><%=e%></td>
						<%i.each do|s,j|%>
							<%j.each do|td|%>
								<%if td != true %>
								<td  class=" success">
									<i class="icon-green icon-ok" title="Livre"></i>
								</td>
								<%else%>
								<td  class=" error">
									<i class="icon-red" title="Ocupado"></i>
								</td>
								<%end%>
							<%end%>
						<%end%>
					</tr>
					<% end%>
				</tbody>
			</table>
		</div>
	</div>
</div>
